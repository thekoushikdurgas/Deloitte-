{
  "declarations": {
    "variables": [
      {
        "name": "V_COUNTER",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "V_CODE",
        "data_type": "VARCHAR2(2)",
        "default_value": null
      },
      {
        "name": "V_ODG_NO",
        "data_type": "VARCHAR2(2)",
        "default_value": null
      },
      {
        "name": "V_RESGRP_CD",
        "data_type": "VARCHAR2(2)",
        "default_value": null
      },
      {
        "name": "V_RESLIN_CD",
        "data_type": "VARCHAR2(2)",
        "default_value": null
      },
      {
        "name": "V_STATUS_CD",
        "data_type": "VARCHAR2(1)",
        "default_value": null
      },
      {
        "name": "V_DBA_CD",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "V_PORTF_PROJ_CD",
        "data_type": "VARCHAR2(1)",
        "default_value": null
      },
      {
        "name": "V_DESCRIPTION",
        "data_type": "VARCHAR2(500)",
        "default_value": null
      },
      {
        "name": "V_RESLIN_DESC",
        "data_type": "VARCHAR2(60)",
        "default_value": null
      },
      {
        "name": "V_THEME_DESC_LENGTH",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "V_D_REGISTRAT_DATE",
        "data_type": "DATE",
        "default_value": null
      },
      {
        "name": "V_D_INS_DATE",
        "data_type": "DATE",
        "default_value": null
      },
      {
        "name": "V_FUTURE_REGISTRAT",
        "data_type": "DATE",
        "default_value": null
      },
      {
        "name": "V_VALID_TO",
        "data_type": "DATE",
        "default_value": null
      },
      {
        "name": "V_USERID",
        "data_type": "VARCHAR2(30)",
        "default_value": null
      },
      {
        "name": "V_IS_ADMIN_CNT",
        "data_type": "SIMPLE_INTEGER",
        "default_value": "0"
      },
      {
        "name": "V_SEC_MOL_CNT",
        "data_type": "SIMPLE_INTEGER",
        "default_value": "0"
      },
      {
        "name": "V_MOLECULE_ID",
        "data_type": "VARCHAR2(5)",
        "default_value": "NULL"
      },
      {
        "name": "V_MOLECULE_RG_NO",
        "data_type": "VARCHAR2(20)",
        "default_value": "NULL"
      },
      {
        "name": "V_MOLEC_IN_LIC_PRTNR",
        "data_type": "VARCHAR2(15)",
        "default_value": "NULL"
      },
      {
        "name": "V_NEW_RG_NO",
        "data_type": "V_THEME_MOLECULES.RG_NO%TYPE",
        "default_value": null
      },
      {
        "name": "V_COMPARATOR_IND",
        "data_type": "V_THEME_MOLECULES.COMPARATOR_IND%TYPE",
        "default_value": null
      },
      {
        "name": "V_THEME_DESC_PROPOSAL",
        "data_type": "MDM_V_THEMES_MTN.THEME_DESC_PROPOSAL%TYPE",
        "default_value": null
      },
      {
        "name": "V_SHORT_NAME",
        "data_type": "VARCHAR2(30)",
        "default_value": null
      },
      {
        "name": "V_EVOLVED_NMP_CNT",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "V_TRADEMARK_NO",
        "data_type": "V_THEMES.TRADEMARK_NO%TYPE",
        "default_value": null
      },
      {
        "name": "V_MOLECULE_TYPE_ID",
        "data_type": "V_MOLECULE_TYPES.MOLECULE_TYPE_ID%TYPE",
        "default_value": null
      },
      {
        "name": "V_PHARMACOLOGICAL_TYPE_ID",
        "data_type": "V_PHARMACOLOGICAL_TYPES.PHARMACOLOGICAL_TYPE_ID%TYPE",
        "default_value": null
      }
    ],
    "constants": [
      {
        "name": "C_MOLECULE_TYPE_ID",
        "data_type": "V_MOLECULE_TYPES.MOLECULE_TYPE_ID%TYPE",
        "value": "99"
      },
      {
        "name": "C_PHARMACOLOGICAL_TYPE_ID",
        "data_type": "V_PHARMACOLOGICAL_TYPES.PHARMACOLOGICAL_TYPE_ID%TYPE",
        "value": "19"
      }
    ],
    "exceptions": [
      {
        "name": "INVALID_THEME_NO",
        "type": "exception"
      },
      {
        "name": "DELETE_NO_MORE_POSSIBLE",
        "type": "exception"
      },
      {
        "name": "THEME_NO_ONLY_INSERT",
        "type": "exception"
      },
      {
        "name": "DESCRIPTION_TOO_LONG",
        "type": "exception"
      },
      {
        "name": "THEME_DESC_PROPOSAL_TOO_LONG",
        "type": "exception"
      },
      {
        "name": "THEME_DESC_ALT_TOO_LONG",
        "type": "exception"
      },
      {
        "name": "THEME_NO_CANNOT_BE_INSERTED",
        "type": "exception"
      },
      {
        "name": "ONLYONEOFFICIALCHANGEPERDAY",
        "type": "exception"
      },
      {
        "name": "INSERTSMUSTBEOFFICIAL",
        "type": "exception"
      },
      {
        "name": "THEMEDESCRIPTIONMANDATORY",
        "type": "exception"
      },
      {
        "name": "THEME_DESC_NOT_UNIQUE",
        "type": "exception"
      },
      {
        "name": "IN_PREP_NOT_PORTF_PROJ",
        "type": "exception"
      },
      {
        "name": "IN_PREP_NOT_CLOSED",
        "type": "exception"
      },
      {
        "name": "INVALID_MOLECULE_ID",
        "type": "exception"
      },
      {
        "name": "SEC_MOL_LIST_NOT_EMPTY",
        "type": "exception"
      },
      {
        "name": "ADMIN_UPDATE_ONLY",
        "type": "exception"
      },
      {
        "name": "PORTF_PROJ_MOL_CRE_ERR",
        "type": "exception"
      },
      {
        "name": "DEBUGGING",
        "type": "exception"
      }
    ]
  },
  "on_insert": [
    {
      "sql": "SELECT NVL(TXO_SECURITY.GET_USERID, USER) INTO V_USERID FROM DUAL",
      "type": "select_statements"
    },
    {
      "sql": "SELECT COUNT(*) INTO V_IS_ADMIN_CNT FROM TXO_USERS_ROLES_MAP WHERE ROLE_ID IN (315) AND USERID = V_USERID",
      "type": "select_statements"
    },
    {
      "sql": "SELECT NEW_RG_NO INTO V_NEW_RG_NO FROM ( SELECT NEW_RG_NO FROM ( SELECT ROWNUM AS NEW_RG_NO FROM DUAL CONNECT BY 1 = 1 AND ROWNUM <= 6999 ) WHERE NEW_RG_NO > 5999 MINUS SELECT TO_NUMBER(RG_NO) FROM V_THEME_MOLECULES ) WHERE ROWNUM = 1",
      "type": "select_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.IN_PREP_IND = 'Y')",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:NEW.PORTF_PROJ_CD <> 'Y')",
          "then_sql": [
            {
              "exception_name": "IN_PREP_NOT_PORTF_PROJ",
              "sqls": [
                {
                  "sql": "RAISE IN_PREP_NOT_PORTF_PROJ",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.STATUS_DESC <> 'CLOSED' AND V_IS_ADMIN_CNT = 0)",
          "then_sql": [
            {
              "exception_name": "IN_PREP_NOT_CLOSED",
              "sqls": [
                {
                  "sql": "RAISE IN_PREP_NOT_CLOSED",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.MOLECULE_ID IS NULL)",
          "then_sql": [
            "TXO_UTIL.SET_WARNING('No Molecule assigned to In-Prep Theme ' || :NEW.THEME_NO || '!')"
          ]
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(:NEW.MOLECULE_ID IS NOT NULL)",
      "then_sql": [
        {
          "sqls": [
            {
              "sql": "SELECT RG_NO, M.COMPARATOR_IND INTO V_MOLECULE_RG_NO, V_COMPARATOR_IND FROM V_THEME_MOLECULES M WHERE MOLECULE_ID = :NEW.MOLECULE_ID AND M.VALID_IND = 'Y'",
              "type": "select_statements"
            }
          ],
          "type": "begin_block",
          "exception_handlers": [
            {
              "exception_name": "NO_DATA_FOUND",
              "sqls": [
                {
                  "sql": "RAISE INVALID_MOLECULE_ID",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(V_MOLECULE_RG_NO IS NULL)",
          "then_sql": [
            {
              "type": "if_else",
              "condition": "(V_COMPARATOR_IND = 'Y')",
              "then_sql": [
                "NULL"
              ],
              "else_statement": [
                {
                  "sql": "UPDATE V_THEME_MOLECULES SET RG_NO = V_NEW_RG_NO WHERE MOLECULE_ID = :NEW.MOLECULE_ID",
                  "type": "update_statements"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "variable": "V_ODG_NO",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 1, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESGRP_CD",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 4, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESLIN_CD",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 7, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESLIN_DESC",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 12, LENGTH(:NEW.RESLIN_DESC_CONCAT))",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.STATUS_DESC IS NOT NULL)",
      "then_sql": [
        {
          "sql": "SELECT STATUS_CD INTO V_STATUS_CD FROM MDM_V_THEME_STATUS WHERE STATE_DESC = :NEW.STATUS_DESC",
          "type": "select_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_STATUS_CD",
          "value": "NULL",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(:NEW.DBA_DESC_CONCAT IS NOT NULL)",
      "then_sql": [
        {
          "sql": "SELECT DBA_CD INTO V_DBA_CD FROM MDM_V_DISEASE_BIOLOGY_AREAS WHERE DBA_SHORT_DESC || ' - ' || DBA_DESC = :NEW.DBA_DESC_CONCAT",
          "type": "select_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_DBA_CD",
          "value": "NULL",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "variable": "V_MOLEC_IN_LIC_PRTNR",
      "value": "GMD_UTIL_THEMES.GET_MOLEC_IN_LIC_PRTNR(:NEW.MOLECULE_ID)",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.OFFICIAL_IND = 'N')",
      "then_sql": [
        {
          "variable": "V_TRADEMARK_NO",
          "value": ":NEW.TRADEMARK_NO",
          "type": "assignment_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_TRADEMARK_NO",
          "value": ":OLD.TRADEMARK_NO",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "variable": "V_THEME_DESC_PROPOSAL",
      "value": "GMD_UTIL_THEMES.GET_THEME_SHORT_NAME(P_THEME_NO_PORTF => :NEW.THEME_NO, P_MOLECULE_ID_PORTF => :NEW.MOLECULE_ID, P_PROD_SHORT_CD_PORTF => :NEW.PROD_SHORT_CD, P_ODG_NO_PORT => V_ODG_NO, P_RESGRP_CD_PORT => V_RESGRP_CD, P_RESLIN_CD_PORT => V_RESLIN_CD, P_LINE_EXT_INFO_PORT => :NEW.LINE_EXT_INFO, P_IN_LIC_PRTNR_PORTF => NULL, P_TRADEMARK_NO_PORTF => V_TRADEMARK_NO, P_TRUNC_DESC_LENGTH => 'N')",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.MANUAL_SHORT_DESC IS NULL AND LENGTH(V_THEME_DESC_PROPOSAL) > 30)",
      "then_sql": [
        {
          "exception_name": "THEME_DESC_PROPOSAL_TOO_LONG",
          "sqls": [
            {
              "sql": "RAISE THEME_DESC_PROPOSAL_TOO_LONG",
              "type": "RAISE_statements"
            }
          ]
        }
      ]
    },
    {
      "variable": "V_SHORT_NAME",
      "value": "COALESCE(:NEW.MANUAL_SHORT_DESC, V_THEME_DESC_PROPOSAL)",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(INSERTING)",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:NEW.IN_PREP_IND = 'N' AND V_IS_ADMIN_CNT = 0)",
          "then_sql": [
            {
              "exception_name": "ADMIN_UPDATE_ONLY",
              "sqls": [
                {
                  "sql": "RAISE ADMIN_UPDATE_ONLY",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "variable": "V_MOLECULE_ID",
          "value": ":NEW.MOLECULE_ID",
          "type": "assignment_statements"
        },
        {
          "type": "if_else",
          "condition": "(:NEW.PORTF_PROJ_CD = 'Y' AND :NEW.MOLECULE_ID IS NULL)",
          "then_sql": [
            {
              "type": "if_else",
              "condition": "(NVL(:NEW.MANUAL_SHORT_DESC, :NEW.THEME_DESC_PROPOSAL) IS NULL)",
              "then_sql": [
                {
                  "exception_name": "PORTF_PROJ_MOL_CRE_ERR",
                  "sqls": [
                    {
                      "sql": "RAISE PORTF_PROJ_MOL_CRE_ERR",
                      "type": "RAISE_statements"
                    }
                  ]
                }
              ],
              "else_statement": [
                {
                  "sql": "INSERT INTO MDM_V_THEME_MOLECULES_MTN( MOLECULE_DESC, VALID_IND, RG_NO, CANCER_IMMUNOTHERAPY_IND, MOLECULE_TYPE_ID, PHARMACOLOGICAL_TYPE_ID ) VALUES ( NVL(:NEW.MANUAL_SHORT_DESC, :NEW.THEME_DESC_PROPOSAL), 'Y', V_NEW_RG_NO, 'N', C_MOLECULE_TYPE_ID, C_PHARMACOLOGICAL_TYPE_ID )",
                  "type": "insert_statements"
                },
                {
                  "sql": "SELECT MOLECULE_ID INTO V_MOLECULE_ID FROM V_THEME_MOLECULES WHERE MOLECULE_DESC = NVL(:NEW.MANUAL_SHORT_DESC, :NEW.THEME_DESC_PROPOSAL) AND VALID_IND = 'Y' AND RG_NO = V_NEW_RG_NO AND CANCER_IMMUNOTHERAPY_IND = 'N' AND MOLECULE_TYPE_ID = C_MOLECULE_TYPE_ID AND PHARMACOLOGICAL_TYPE_ID = C_PHARMACOLOGICAL_TYPE_ID",
                  "type": "select_statements"
                },
                {
                  "sql": "INSERT INTO THEME_MOLECULE_MAP TMMAP( TMMAP.THEME_NO, TMMAP.MOLECULE_ID, TMMAP.MOLECULE_SEQ_NO, TMMAP.VALID_IND ) VALUES ( :NEW.THEME_NO, V_MOLECULE_ID, 1, 'Y' )",
                  "type": "insert_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "case_when_statements",
          "case_expression": "LENGTH(:NEW.THEME_NO)",
          "when_clauses": [
            {
              "when_value": "4",
              "then_statement": [
                {
                  "type": "if_else",
                  "condition": "(SUBSTR(:NEW.THEME_NO, 1, 1) NOT BETWEEN 0 AND 9 OR SUBSTR(:NEW.THEME_NO, 2, 1) NOT BETWEEN 0 AND 9 OR SUBSTR(:NEW.THEME_NO, 3, 1) NOT BETWEEN 0 AND 9 OR SUBSTR(:NEW.THEME_NO, 4, 1) NOT BETWEEN 0 AND 9)",
                  "then_sql": [
                    {
                      "exception_name": "INVALID_THEME_NO",
                      "sqls": [
                        {
                          "sql": "RAISE INVALID_THEME_NO",
                          "type": "RAISE_statements"
                        }
                      ]
                    }
                  ]
                }
              ],
              "else_statement": null
            },
            {
              "when_value": "5",
              "then_statement": [
                {
                  "type": "if_else",
                  "condition": "(SUBSTR(:NEW.THEME_NO, 1, 1) NOT BETWEEN 0 AND 9 OR SUBSTR(:NEW.THEME_NO, 2, 1) NOT BETWEEN 0 AND 9 OR SUBSTR(:NEW.THEME_NO, 3, 1) NOT BETWEEN 0 AND 9 OR SUBSTR(:NEW.THEME_NO, 4, 1) NOT BETWEEN 0 AND 9 OR SUBSTR(:NEW.THEME_NO, 5, 1) NOT BETWEEN 0 AND 9)",
                  "then_sql": [
                    {
                      "exception_name": "INVALID_THEME_NO",
                      "sqls": [
                        {
                          "sql": "RAISE INVALID_THEME_NO",
                          "type": "RAISE_statements"
                        }
                      ]
                    }
                  ]
                }
              ],
              "else_statement": null
            }
          ]
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(INSERTING OR UPDATING)",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:NEW.PROPOSAL_ID IS NOT NULL AND :OLD.PROPOSAL_ID IS NULL)",
          "then_sql": [
            {
              "sql": "SELECT COUNT(*) INTO V_EVOLVED_NMP_CNT FROM MDM_V_NEW_MEDICINE_PROPOSALS_MTN WHERE PROPOSAL_ID = :NEW.PROPOSAL_ID AND PROPOSAL_STATUS_CD = 'E'",
              "type": "select_statements"
            },
            {
              "type": "if_else",
              "condition": "(V_EVOLVED_NMP_CNT = 0)",
              "then_sql": [
                {
                  "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'E', EVOLVED_THEME_NO = :NEW.THEME_NO, PROPOSAL_NAME = V_SHORT_NAME, REASON_FOR_CHANGE = '** Automatic update of proposal_name after short_name change in evolved theme **' WHERE PROPOSAL_ID = :NEW.PROPOSAL_ID",
                  "type": "update_statements"
                }
              ]
            }
          ],
          "else_statement": [
            {
              "type": "if_else",
              "condition": "(:NEW.PROPOSAL_ID IS NULL AND :OLD.PROPOSAL_ID IS NOT NULL)",
              "then_sql": [
                {
                  "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'A', EVOLVED_THEME_NO = NULL WHERE PROPOSAL_ID = :OLD.PROPOSAL_ID",
                  "type": "update_statements"
                }
              ],
              "else_statement": [
                {
                  "type": "if_else",
                  "condition": "(:NEW.PROPOSAL_ID IS NOT NULL AND :OLD.PROPOSAL_ID IS NOT NULL AND :NEW.PROPOSAL_ID <> :OLD.PROPOSAL_ID)",
                  "then_sql": [
                    {
                      "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'A', EVOLVED_THEME_NO = NULL WHERE PROPOSAL_ID = :OLD.PROPOSAL_ID",
                      "type": "update_statements"
                    },
                    {
                      "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'E', EVOLVED_THEME_NO = :NEW.THEME_NO, PROPOSAL_NAME = V_SHORT_NAME, REASON_FOR_CHANGE = '** Automatic update of proposal_name after short_name change in evolved theme **' WHERE PROPOSAL_ID = :NEW.PROPOSAL_ID",
                      "type": "update_statements"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(NVL(:NEW.PROPOSAL_ID, 0) = NVL(:OLD.PROPOSAL_ID, 0) AND NVL(:OLD.SHORT_NAME, '-') <> NVL(V_SHORT_NAME, '-'))",
          "then_sql": [
            {
              "sql": "SELECT COUNT(*) INTO V_EVOLVED_NMP_CNT FROM MDM_V_NEW_MEDICINE_PROPOSALS_MTN NMP WHERE NMP.EVOLVED_THEME_NO =:NEW.THEME_NO AND NMP.PROPOSAL_STATUS_CD = 'E'",
              "type": "select_statements"
            },
            {
              "type": "if_else",
              "condition": "(V_EVOLVED_NMP_CNT > 0)",
              "then_sql": [
                {
                  "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN NMP SET NMP.PROPOSAL_NAME = V_SHORT_NAME, NMP.REASON_FOR_CHANGE = '** Automatic update of proposal_name after short_name change in evolved theme **' WHERE NMP.EVOLVED_THEME_NO =:NEW.THEME_NO AND NMP.PROPOSAL_STATUS_CD = 'E'",
                  "type": "update_statements"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(INSERTING AND :NEW.THEME_NO IS NOT NULL AND GMD_UTIL_THEMES.GET_THEMES_RANGE_AUTOMATIC_NMP(:NEW.THEME_NO) = 'Y')",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:NEW.PROPOSAL_ID IS NOT NULL)",
          "then_sql": [
            {
              "sql": "SELECT COUNT(*) INTO V_EVOLVED_NMP_CNT FROM MDM_V_NEW_MEDICINE_PROPOSALS_MTN WHERE PROPOSAL_ID = :NEW.PROPOSAL_ID AND PROPOSAL_NAME = V_SHORT_NAME AND PROPOSAL_STATUS_CD = 'E'",
              "type": "select_statements"
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.PROPOSAL_ID IS NULL OR (:NEW.PROPOSAL_ID IS NOT NULL AND V_EVOLVED_NMP_CNT = 0))",
          "then_sql": [
            {
              "type": "if_else",
              "condition": "(:NEW.MOLECULE_ID IS NOT NULL)",
              "then_sql": [
                {
                  "sqls": [
                    {
                      "sql": "SELECT PHARMACOLOGICAL_TYPE_ID, MOLECULE_TYPE_ID INTO V_PHARMACOLOGICAL_TYPE_ID, V_MOLECULE_TYPE_ID FROM V_THEME_MOLECULES M WHERE MOLECULE_ID = :NEW.MOLECULE_ID AND M.VALID_IND = 'Y'",
                      "type": "select_statements"
                    }
                  ],
                  "type": "begin_block",
                  "exception_handlers": [
                    {
                      "exception_name": "NO_DATA_FOUND",
                      "sqls": [
                        {
                          "sql": "RAISE INVALID_MOLECULE_ID",
                          "type": "RAISE_statements"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "sql": "INSERT INTO MDM_V_NEW_MEDICINE_PROPOSALS_MTN ( PROPOSAL_STATUS_CD, EVOLVED_THEME_NO, PROPOSAL_NAME, PHARMACOLOGICAL_TYPE_ID, MOLECULE_TYPE_ID, REASON_FOR_CHANGE ) VALUES ( 'E', :NEW.THEME_NO, V_SHORT_NAME, NVL(V_PHARMACOLOGICAL_TYPE_ID, C_PHARMACOLOGICAL_TYPE_ID), NVL(V_MOLECULE_TYPE_ID, C_MOLECULE_TYPE_ID), '** Automatic creation of nmp for early development themes **' )",
              "type": "insert_statements"
            }
          ]
        }
      ]
    },
    {
      "type": "for_loop",
      "loop_variable": "I1",
      "loop_body": [
        {
          "sql": "DELETE FROM GMD.THEMES WHERE THEME_NO = I1.THEME_NO AND REGISTRAT_DATE = I1.REGISTRAT_DATE",
          "type": "delete_statements"
        }
      ],
      "cursor_query": " SELECT A.THEME_NO, A.REGISTRAT_DATE FROM V_THEMES A WHERE A.VALID_TO <= TRUNC(SYSDATE)"
    }
  ],
  "on_update": [
    {
      "sql": "SELECT NVL(TXO_SECURITY.GET_USERID, USER) INTO V_USERID FROM DUAL",
      "type": "select_statements"
    },
    {
      "sql": "SELECT COUNT(*) INTO V_IS_ADMIN_CNT FROM TXO_USERS_ROLES_MAP WHERE ROLE_ID IN (315) AND USERID = V_USERID",
      "type": "select_statements"
    },
    {
      "sql": "SELECT NEW_RG_NO INTO V_NEW_RG_NO FROM ( SELECT NEW_RG_NO FROM ( SELECT ROWNUM AS NEW_RG_NO FROM DUAL CONNECT BY 1 = 1 AND ROWNUM <= 6999 ) WHERE NEW_RG_NO > 5999 MINUS SELECT TO_NUMBER(RG_NO) FROM V_THEME_MOLECULES ) WHERE ROWNUM = 1",
      "type": "select_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.IN_PREP_IND = 'Y')",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:NEW.PORTF_PROJ_CD <> 'Y')",
          "then_sql": [
            {
              "exception_name": "IN_PREP_NOT_PORTF_PROJ",
              "sqls": [
                {
                  "sql": "RAISE IN_PREP_NOT_PORTF_PROJ",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.STATUS_DESC <> 'CLOSED' AND V_IS_ADMIN_CNT = 0)",
          "then_sql": [
            {
              "exception_name": "IN_PREP_NOT_CLOSED",
              "sqls": [
                {
                  "sql": "RAISE IN_PREP_NOT_CLOSED",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.MOLECULE_ID IS NULL)",
          "then_sql": [
            "TXO_UTIL.SET_WARNING('No Molecule assigned to In-Prep Theme ' || :NEW.THEME_NO || '!')"
          ]
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(:NEW.MOLECULE_ID IS NOT NULL)",
      "then_sql": [
        {
          "sqls": [
            {
              "sql": "SELECT RG_NO, M.COMPARATOR_IND INTO V_MOLECULE_RG_NO, V_COMPARATOR_IND FROM V_THEME_MOLECULES M WHERE MOLECULE_ID = :NEW.MOLECULE_ID AND M.VALID_IND = 'Y'",
              "type": "select_statements"
            }
          ],
          "type": "begin_block",
          "exception_handlers": [
            {
              "exception_name": "NO_DATA_FOUND",
              "sqls": [
                {
                  "sql": "RAISE INVALID_MOLECULE_ID",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(V_MOLECULE_RG_NO IS NULL)",
          "then_sql": [
            {
              "type": "if_else",
              "condition": "(V_COMPARATOR_IND = 'Y')",
              "then_sql": [
                "NULL"
              ],
              "else_statement": [
                {
                  "sql": "UPDATE V_THEME_MOLECULES SET RG_NO = V_NEW_RG_NO WHERE MOLECULE_ID = :NEW.MOLECULE_ID",
                  "type": "update_statements"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "variable": "V_ODG_NO",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 1, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESGRP_CD",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 4, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESLIN_CD",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 7, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESLIN_DESC",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 12, LENGTH(:NEW.RESLIN_DESC_CONCAT))",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.STATUS_DESC IS NOT NULL)",
      "then_sql": [
        {
          "sql": "SELECT STATUS_CD INTO V_STATUS_CD FROM MDM_V_THEME_STATUS WHERE STATE_DESC = :NEW.STATUS_DESC",
          "type": "select_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_STATUS_CD",
          "value": "NULL",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(:NEW.DBA_DESC_CONCAT IS NOT NULL)",
      "then_sql": [
        {
          "sql": "SELECT DBA_CD INTO V_DBA_CD FROM MDM_V_DISEASE_BIOLOGY_AREAS WHERE DBA_SHORT_DESC || ' - ' || DBA_DESC = :NEW.DBA_DESC_CONCAT",
          "type": "select_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_DBA_CD",
          "value": "NULL",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "variable": "V_MOLEC_IN_LIC_PRTNR",
      "value": "GMD_UTIL_THEMES.GET_MOLEC_IN_LIC_PRTNR(:NEW.MOLECULE_ID)",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.OFFICIAL_IND = 'N')",
      "then_sql": [
        {
          "variable": "V_TRADEMARK_NO",
          "value": ":NEW.TRADEMARK_NO",
          "type": "assignment_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_TRADEMARK_NO",
          "value": ":OLD.TRADEMARK_NO",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "variable": "V_THEME_DESC_PROPOSAL",
      "value": "GMD_UTIL_THEMES.GET_THEME_SHORT_NAME(P_THEME_NO_PORTF => :NEW.THEME_NO, P_MOLECULE_ID_PORTF => :NEW.MOLECULE_ID, P_PROD_SHORT_CD_PORTF => :NEW.PROD_SHORT_CD, P_ODG_NO_PORT => V_ODG_NO, P_RESGRP_CD_PORT => V_RESGRP_CD, P_RESLIN_CD_PORT => V_RESLIN_CD, P_LINE_EXT_INFO_PORT => :NEW.LINE_EXT_INFO, P_IN_LIC_PRTNR_PORTF => NULL, P_TRADEMARK_NO_PORTF => V_TRADEMARK_NO, P_TRUNC_DESC_LENGTH => 'N')",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.MANUAL_SHORT_DESC IS NULL AND LENGTH(V_THEME_DESC_PROPOSAL) > 30)",
      "then_sql": [
        {
          "exception_name": "THEME_DESC_PROPOSAL_TOO_LONG",
          "sqls": [
            {
              "sql": "RAISE THEME_DESC_PROPOSAL_TOO_LONG",
              "type": "RAISE_statements"
            }
          ]
        }
      ]
    },
    {
      "variable": "V_SHORT_NAME",
      "value": "COALESCE(:NEW.MANUAL_SHORT_DESC, V_THEME_DESC_PROPOSAL)",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(UPDATING)",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:OLD.IN_PREP_IND = 'N' OR (:OLD.IN_PREP_IND = 'Y' AND :NEW.IN_PREP_IND = 'N')) AND V_IS_ADMIN_CNT = 0",
          "then_sql": [
            {
              "exception_name": "ADMIN_UPDATE_ONLY",
              "sqls": [
                {
                  "sql": "RAISE ADMIN_UPDATE_ONLY",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.THEME_NO <> :OLD.THEME_NO)",
          "then_sql": [
            {
              "exception_name": "THEME_NO_ONLY_INSERT",
              "sqls": [
                {
                  "sql": "RAISE THEME_NO_ONLY_INSERT",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.OFFICIAL_IND = 'N')",
          "then_sql": [
            {
              "variable": "V_D_REGISTRAT_DATE",
              "value": "TO_DATE(:OLD.REGISTRAT_DATE, 'dd-mm-yyyy')",
              "type": "assignment_statements"
            }
          ],
          "else_statement": [
            {
              "variable": "V_D_REGISTRAT_DATE",
              "value": "SYSDATE",
              "type": "assignment_statements"
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(UPPER(:NEW.PORTF_PROJ_CD) = 'Y' AND(V_STATUS_CD <> 'C' OR:NEW.IN_PREP_IND = 'Y')) UPPER(:NEW.PORTF_PROJ_CD)",
          "then_sql": [
            {
              "variable": "V_DESCRIPTION",
              "value": "GMD.GMD_UTIL_THEMES.GET_THEME_DESC_PORTFOLIO( P_THEME_NO_PORTF => :NEW.THEME_NO, P_MOLECULE_ID_PORTF => :NEW.MOLECULE_ID, P_PROD_SHORT_CD_PORTF => :NEW.PROD_SHORT_CD, P_ODG_NO_PORT => V_ODG_NO, P_RESGRP_CD_PORT => V_RESGRP_CD, P_RESLIN_CD_PORT => V_RESLIN_CD, P_LINE_EXT_INFO_PORT => :NEW.LINE_EXT_INFO, P_IN_LIC_PRTNR_PORTF => V_MOLEC_IN_LIC_PRTNR, P_TRADEMARK_NO_PORTF => :NEW.TRADEMARK_NO, P_SHORT_NAME_PORTF => :NEW.SHORT_NAME, P_TRUNC_DESC_LENGTH => 'N' )",
              "type": "assignment_statements"
            },
            {
              "variable": "V_DESCRIPTION",
              "value": "TRIM(V_DESCRIPTION)",
              "type": "assignment_statements"
            },
            {
              "variable": "V_PORTF_PROJ_CD",
              "value": "'Y'",
              "type": "assignment_statements"
            }
          ],
          "else_statement": [
            {
              "type": "if_else",
              "condition": "(:NEW.THEME_DESC IS NULL OR LENGTH(:NEW.THEME_DESC) = 0)",
              "then_sql": [
                {
                  "exception_name": "THEMEDESCRIPTIONMANDATORY",
                  "sqls": [
                    {
                      "sql": "RAISE THEMEDESCRIPTIONMANDATORY",
                      "type": "RAISE_statements"
                    }
                  ]
                }
              ],
              "else_statement": [
                {
                  "variable": "V_DESCRIPTION",
                  "value": ":NEW.THEME_DESC",
                  "type": "assignment_statements"
                },
                {
                  "variable": "V_PORTF_PROJ_CD",
                  "value": ":NEW.PORTF_PROJ_CD",
                  "type": "assignment_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(LENGTH(V_DESCRIPTION) > 90)",
          "then_sql": [
            {
              "exception_name": "DESCRIPTION_TOO_LONG",
              "sqls": [
                {
                  "sql": "RAISE DESCRIPTION_TOO_LONG",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "variable": "V_COUNTER",
          "value": "NULL",
          "type": "assignment_statements"
        },
        {
          "sql": "SELECT COUNT(T.THEME_NO) INTO V_COUNTER FROM V_THEMES T WHERE T.THEME_DESC = V_DESCRIPTION AND T.THEME_NO <> :NEW.THEME_NO",
          "type": "select_statements"
        },
        {
          "type": "if_else",
          "condition": "(V_COUNTER > 0)",
          "then_sql": [
            {
              "exception_name": "THEME_DESC_NOT_UNIQUE",
              "sqls": [
                {
                  "sql": "RAISE THEME_DESC_NOT_UNIQUE",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "variable": "V_COUNTER",
          "value": "NULL",
          "type": "assignment_statements"
        },
        {
          "type": "if_else",
          "condition": "(:NEW.OFFICIAL_IND = 'N')",
          "then_sql": [
            {
              "sql": "UPDATE GMD.THEMES SET ODG_NO = V_ODG_NO, RESGRP_CD = V_RESGRP_CD, RESLIN_CD = V_RESLIN_CD, THEME_DESC = V_DESCRIPTION, SHORT_NAME = V_SHORT_NAME, STATUS_CD = V_STATUS_CD, DBA_CD = V_DBA_CD, IN_PREP_IND = :NEW.IN_PREP_IND, PROD_SHORT_CD = :NEW.PROD_SHORT_CD, TRADEMARK_NO = :NEW.TRADEMARK_NO, BIO_ACTIVITY = :NEW.BIO_ACTIVITY, APPLICANT = :NEW.APPLICANT, CONTACT = :NEW.CONTACT, LINE_EXT_INFO = :NEW.LINE_EXT_INFO, PORTF_PROJ_CD = V_PORTF_PROJ_CD, CO_DEV_PRTNR = :NEW.CO_DEV_PRTNR, TECHNOLOGY_PRTNR = :NEW.TECHNOLOGY_PRTNR, OFFICIAL_IND = :NEW.OFFICIAL_IND, CO_MAR_PRTNR = :NEW.CO_MAR_PRTNR, PORTF_DA_GROUP_ID = :NEW.PORTF_DA_GROUP_ID, MANUAL_SHORT_DESC = :NEW.MANUAL_SHORT_DESC WHERE THEME_NO = :NEW.THEME_NO AND TO_DATE(REGISTRAT_DATE, 'DD-MM-YYYY') = V_D_REGISTRAT_DATE",
              "type": "update_statements"
            }
          ],
          "else_statement": [
            {
              "variable": "V_COUNTER",
              "value": "NULL",
              "type": "assignment_statements"
            },
            {
              "sql": "SELECT COUNT(*) INTO V_COUNTER FROM V_THEMES T WHERE TRUNC(T.REGISTRAT_DATE) = TRUNC(SYSDATE) AND T.THEME_NO = :NEW.THEME_NO",
              "type": "select_statements"
            },
            {
              "type": "if_else",
              "condition": "(V_COUNTER > 0)",
              "then_sql": [
                {
                  "exception_name": "ONLYONEOFFICIALCHANGEPERDAY",
                  "sqls": [
                    {
                      "sql": "RAISE ONLYONEOFFICIALCHANGEPERDAY",
                      "type": "RAISE_statements"
                    }
                  ]
                }
              ]
            },
            {
              "variable": "V_COUNTER",
              "value": "NULL",
              "type": "assignment_statements"
            },
            {
              "sql": "UPDATE GMD.THEMES SET ODG_NO = V_ODG_NO, RESGRP_CD = V_RESGRP_CD, RESLIN_CD = V_RESLIN_CD, THEME_DESC = V_DESCRIPTION, SHORT_NAME = V_SHORT_NAME, STATUS_CD = V_STATUS_CD, DBA_CD = V_DBA_CD, IN_PREP_IND = :NEW.IN_PREP_IND, PROD_SHORT_CD = :NEW.PROD_SHORT_CD, TRADEMARK_NO = :NEW.TRADEMARK_NO, BIO_ACTIVITY = :NEW.BIO_ACTIVITY, APPLICANT = :NEW.APPLICANT, CONTACT = :NEW.CONTACT, LINE_EXT_INFO = :NEW.LINE_EXT_INFO, PORTF_PROJ_CD = V_PORTF_PROJ_CD, CO_DEV_PRTNR = :NEW.CO_DEV_PRTNR, TECHNOLOGY_PRTNR = :NEW.TECHNOLOGY_PRTNR, OFFICIAL_IND = :NEW.OFFICIAL_IND, CO_MAR_PRTNR = :NEW.CO_MAR_PRTNR, REGISTRAT_DATE = SYSDATE, REGISTRAR = V_USERID, PORTF_DA_GROUP_ID = :NEW.PORTF_DA_GROUP_ID, MANUAL_SHORT_DESC = :NEW.MANUAL_SHORT_DESC WHERE THEME_NO = :NEW.THEME_NO",
              "type": "update_statements"
            }
          ]
        },
        {
          "type": "case_when_statements",
          "case_expression": "",
          "when_clauses": [
            {
              "when_value": ":OLD.MOLECULE_ID IS NULL AND :NEW.MOLECULE_ID IS NOT NULL",
              "then_statement": [
                {
                  "sql": "INSERT INTO MDM_V_THEME_MOLECULE_MAP_MTN A( A.THEME_NO, A.MOLECULE_ID, A.MOLECULE_SEQ_NO, A.VALID_IND ) VALUES ( :NEW.THEME_NO, :NEW.MOLECULE_ID, 1, 'Y' )",
                  "type": "insert_statements"
                }
              ],
              "else_statement": null
            },
            {
              "when_value": ":OLD.MOLECULE_ID IS NOT NULL AND :NEW.MOLECULE_ID IS NOT NULL",
              "then_statement": [
                {
                  "sql": "UPDATE MDM_V_THEME_MOLECULE_MAP A SET A.MOLECULE_ID = :NEW.MOLECULE_ID, A.VALID_IND = 'Y' WHERE A.THEME_NO = :NEW.THEME_NO AND A.MOLECULE_SEQ_NO = 1 AND A.VALID_IND = 'Y'",
                  "type": "update_statements"
                }
              ],
              "else_statement": null
            },
            {
              "when_value": ":OLD.MOLECULE_ID IS NOT NULL AND :NEW.MOLECULE_ID IS NULL",
              "then_statement": [
                {
                  "sql": "SELECT COUNT(*) INTO V_SEC_MOL_CNT FROM MDM_V_THEME_MOLECULE_MAP_MTN A WHERE A.THEME_NO = :NEW.THEME_NO AND A.MOLECULE_SEQ_NO > 1 AND A.VALID_IND = 'Y'",
                  "type": "select_statements"
                },
                {
                  "type": "if_else",
                  "condition": "(V_SEC_MOL_CNT > 0)",
                  "then_sql": [
                    {
                      "exception_name": "SEC_MOL_LIST_NOT_EMPTY",
                      "sqls": [
                        {
                          "sql": "RAISE SEC_MOL_LIST_NOT_EMPTY",
                          "type": "RAISE_statements"
                        }
                      ]
                    }
                  ],
                  "else_statement": [
                    {
                      "sql": "UPDATE MDM_V_THEME_MOLECULE_MAP A SET A.VALID_IND = 'N' WHERE A.MOLECULE_ID = :OLD.MOLECULE_ID AND A.THEME_NO = :NEW.THEME_NO AND A.MOLECULE_SEQ_NO = 1 AND A.VALID_IND = 'Y'",
                      "type": "update_statements"
                    }
                  ]
                }
              ],
              "else_statement": null
            }
          ]
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(INSERTING OR UPDATING)",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:NEW.PROPOSAL_ID IS NOT NULL AND :OLD.PROPOSAL_ID IS NULL)",
          "then_sql": [
            {
              "sql": "SELECT COUNT(*) INTO V_EVOLVED_NMP_CNT FROM MDM_V_NEW_MEDICINE_PROPOSALS_MTN WHERE PROPOSAL_ID = :NEW.PROPOSAL_ID AND PROPOSAL_STATUS_CD = 'E'",
              "type": "select_statements"
            },
            {
              "type": "if_else",
              "condition": "(V_EVOLVED_NMP_CNT = 0)",
              "then_sql": [
                {
                  "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'E', EVOLVED_THEME_NO = :NEW.THEME_NO, PROPOSAL_NAME = V_SHORT_NAME, REASON_FOR_CHANGE = '** Automatic update of proposal_name after short_name change in evolved theme **' WHERE PROPOSAL_ID = :NEW.PROPOSAL_ID",
                  "type": "update_statements"
                }
              ]
            }
          ],
          "else_statement": [
            {
              "type": "if_else",
              "condition": "(:NEW.PROPOSAL_ID IS NULL AND :OLD.PROPOSAL_ID IS NOT NULL)",
              "then_sql": [
                {
                  "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'A', EVOLVED_THEME_NO = NULL WHERE PROPOSAL_ID = :OLD.PROPOSAL_ID",
                  "type": "update_statements"
                }
              ],
              "else_statement": [
                {
                  "type": "if_else",
                  "condition": "(:NEW.PROPOSAL_ID IS NOT NULL AND :OLD.PROPOSAL_ID IS NOT NULL AND :NEW.PROPOSAL_ID <> :OLD.PROPOSAL_ID)",
                  "then_sql": [
                    {
                      "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'A', EVOLVED_THEME_NO = NULL WHERE PROPOSAL_ID = :OLD.PROPOSAL_ID",
                      "type": "update_statements"
                    },
                    {
                      "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN SET PROPOSAL_STATUS_CD = 'E', EVOLVED_THEME_NO = :NEW.THEME_NO, PROPOSAL_NAME = V_SHORT_NAME, REASON_FOR_CHANGE = '** Automatic update of proposal_name after short_name change in evolved theme **' WHERE PROPOSAL_ID = :NEW.PROPOSAL_ID",
                      "type": "update_statements"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(NVL(:NEW.PROPOSAL_ID, 0) = NVL(:OLD.PROPOSAL_ID, 0) AND NVL(:OLD.SHORT_NAME, '-') <> NVL(V_SHORT_NAME, '-'))",
          "then_sql": [
            {
              "sql": "SELECT COUNT(*) INTO V_EVOLVED_NMP_CNT FROM MDM_V_NEW_MEDICINE_PROPOSALS_MTN NMP WHERE NMP.EVOLVED_THEME_NO =:NEW.THEME_NO AND NMP.PROPOSAL_STATUS_CD = 'E'",
              "type": "select_statements"
            },
            {
              "type": "if_else",
              "condition": "(V_EVOLVED_NMP_CNT > 0)",
              "then_sql": [
                {
                  "sql": "UPDATE MDM_V_NEW_MEDICINE_PROPOSALS_MTN NMP SET NMP.PROPOSAL_NAME = V_SHORT_NAME, NMP.REASON_FOR_CHANGE = '** Automatic update of proposal_name after short_name change in evolved theme **' WHERE NMP.EVOLVED_THEME_NO =:NEW.THEME_NO AND NMP.PROPOSAL_STATUS_CD = 'E'",
                  "type": "update_statements"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "for_loop",
      "loop_variable": "I1",
      "loop_body": [
        {
          "sql": "DELETE FROM GMD.THEMES WHERE THEME_NO = I1.THEME_NO AND REGISTRAT_DATE = I1.REGISTRAT_DATE",
          "type": "delete_statements"
        }
      ],
      "cursor_query": " SELECT A.THEME_NO, A.REGISTRAT_DATE FROM V_THEMES A WHERE A.VALID_TO <= TRUNC(SYSDATE)"
    }
  ],
  "on_delete": [
    {
      "sql": "SELECT NVL(TXO_SECURITY.GET_USERID, USER) INTO V_USERID FROM DUAL",
      "type": "select_statements"
    },
    {
      "sql": "SELECT COUNT(*) INTO V_IS_ADMIN_CNT FROM TXO_USERS_ROLES_MAP WHERE ROLE_ID IN (315) AND USERID = V_USERID",
      "type": "select_statements"
    },
    {
      "sql": "SELECT NEW_RG_NO INTO V_NEW_RG_NO FROM ( SELECT NEW_RG_NO FROM ( SELECT ROWNUM AS NEW_RG_NO FROM DUAL CONNECT BY 1 = 1 AND ROWNUM <= 6999 ) WHERE NEW_RG_NO > 5999 MINUS SELECT TO_NUMBER(RG_NO) FROM V_THEME_MOLECULES ) WHERE ROWNUM = 1",
      "type": "select_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.IN_PREP_IND = 'Y')",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "(:NEW.PORTF_PROJ_CD <> 'Y')",
          "then_sql": [
            {
              "exception_name": "IN_PREP_NOT_PORTF_PROJ",
              "sqls": [
                {
                  "sql": "RAISE IN_PREP_NOT_PORTF_PROJ",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.STATUS_DESC <> 'CLOSED' AND V_IS_ADMIN_CNT = 0)",
          "then_sql": [
            {
              "exception_name": "IN_PREP_NOT_CLOSED",
              "sqls": [
                {
                  "sql": "RAISE IN_PREP_NOT_CLOSED",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(:NEW.MOLECULE_ID IS NULL)",
          "then_sql": [
            "TXO_UTIL.SET_WARNING('No Molecule assigned to In-Prep Theme ' || :NEW.THEME_NO || '!')"
          ]
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(:NEW.MOLECULE_ID IS NOT NULL)",
      "then_sql": [
        {
          "sqls": [
            {
              "sql": "SELECT RG_NO, M.COMPARATOR_IND INTO V_MOLECULE_RG_NO, V_COMPARATOR_IND FROM V_THEME_MOLECULES M WHERE MOLECULE_ID = :NEW.MOLECULE_ID AND M.VALID_IND = 'Y'",
              "type": "select_statements"
            }
          ],
          "type": "begin_block",
          "exception_handlers": [
            {
              "exception_name": "NO_DATA_FOUND",
              "sqls": [
                {
                  "sql": "RAISE INVALID_MOLECULE_ID",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(V_MOLECULE_RG_NO IS NULL)",
          "then_sql": [
            {
              "type": "if_else",
              "condition": "(V_COMPARATOR_IND = 'Y')",
              "then_sql": [
                "NULL"
              ],
              "else_statement": [
                {
                  "sql": "UPDATE V_THEME_MOLECULES SET RG_NO = V_NEW_RG_NO WHERE MOLECULE_ID = :NEW.MOLECULE_ID",
                  "type": "update_statements"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "variable": "V_ODG_NO",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 1, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESGRP_CD",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 4, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESLIN_CD",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 7, 2)",
      "type": "assignment_statements"
    },
    {
      "variable": "V_RESLIN_DESC",
      "value": "SUBSTR(:NEW.RESLIN_DESC_CONCAT, 12, LENGTH(:NEW.RESLIN_DESC_CONCAT))",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.STATUS_DESC IS NOT NULL)",
      "then_sql": [
        {
          "sql": "SELECT STATUS_CD INTO V_STATUS_CD FROM MDM_V_THEME_STATUS WHERE STATE_DESC = :NEW.STATUS_DESC",
          "type": "select_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_STATUS_CD",
          "value": "NULL",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "type": "if_else",
      "condition": "(:NEW.DBA_DESC_CONCAT IS NOT NULL)",
      "then_sql": [
        {
          "sql": "SELECT DBA_CD INTO V_DBA_CD FROM MDM_V_DISEASE_BIOLOGY_AREAS WHERE DBA_SHORT_DESC || ' - ' || DBA_DESC = :NEW.DBA_DESC_CONCAT",
          "type": "select_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_DBA_CD",
          "value": "NULL",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "variable": "V_MOLEC_IN_LIC_PRTNR",
      "value": "GMD_UTIL_THEMES.GET_MOLEC_IN_LIC_PRTNR(:NEW.MOLECULE_ID)",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.OFFICIAL_IND = 'N')",
      "then_sql": [
        {
          "variable": "V_TRADEMARK_NO",
          "value": ":NEW.TRADEMARK_NO",
          "type": "assignment_statements"
        }
      ],
      "else_statement": [
        {
          "variable": "V_TRADEMARK_NO",
          "value": ":OLD.TRADEMARK_NO",
          "type": "assignment_statements"
        }
      ]
    },
    {
      "variable": "V_THEME_DESC_PROPOSAL",
      "value": "GMD_UTIL_THEMES.GET_THEME_SHORT_NAME(P_THEME_NO_PORTF => :NEW.THEME_NO, P_MOLECULE_ID_PORTF => :NEW.MOLECULE_ID, P_PROD_SHORT_CD_PORTF => :NEW.PROD_SHORT_CD, P_ODG_NO_PORT => V_ODG_NO, P_RESGRP_CD_PORT => V_RESGRP_CD, P_RESLIN_CD_PORT => V_RESLIN_CD, P_LINE_EXT_INFO_PORT => :NEW.LINE_EXT_INFO, P_IN_LIC_PRTNR_PORTF => NULL, P_TRADEMARK_NO_PORTF => V_TRADEMARK_NO, P_TRUNC_DESC_LENGTH => 'N')",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(:NEW.MANUAL_SHORT_DESC IS NULL AND LENGTH(V_THEME_DESC_PROPOSAL) > 30)",
      "then_sql": [
        {
          "exception_name": "THEME_DESC_PROPOSAL_TOO_LONG",
          "sqls": [
            {
              "sql": "RAISE THEME_DESC_PROPOSAL_TOO_LONG",
              "type": "RAISE_statements"
            }
          ]
        }
      ]
    },
    {
      "variable": "V_SHORT_NAME",
      "value": "COALESCE(:NEW.MANUAL_SHORT_DESC, V_THEME_DESC_PROPOSAL)",
      "type": "assignment_statements"
    },
    {
      "type": "if_else",
      "condition": "(DELETING)",
      "then_sql": [
        {
          "type": "if_else",
          "condition": "((:OLD.IN_PREP_IND = 'N') AND V_IS_ADMIN_CNT = 0)",
          "then_sql": [
            {
              "exception_name": "ADMIN_UPDATE_ONLY",
              "sqls": [
                {
                  "sql": "RAISE ADMIN_UPDATE_ONLY",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        },
        {
          "type": "if_else",
          "condition": "(TRUNC(TO_DATE(:OLD.REGISTRAT_DATE, 'DD-MM-YYYY')) = TRUNC(SYSDATE))",
          "then_sql": [
            {
              "sql": "DELETE FROM GMD.THEMES A WHERE A.THEME_NO = :OLD.THEME_NO AND TRUNC(A.REGISTRAT_DATE) = TRUNC(SYSDATE)",
              "type": "delete_statements"
            }
          ],
          "else_statement": [
            {
              "exception_name": "DELETE_NO_MORE_POSSIBLE",
              "sqls": [
                {
                  "sql": "RAISE DELETE_NO_MORE_POSSIBLE",
                  "type": "RAISE_statements"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "for_loop",
      "loop_variable": "I1",
      "loop_body": [
        {
          "sql": "DELETE FROM GMD.THEMES WHERE THEME_NO = I1.THEME_NO AND REGISTRAT_DATE = I1.REGISTRAT_DATE",
          "type": "delete_statements"
        }
      ],
      "cursor_query": " SELECT A.THEME_NO, A.REGISTRAT_DATE FROM V_THEMES A WHERE A.VALID_TO <= TRUNC(SYSDATE)"
    }
  ]
}