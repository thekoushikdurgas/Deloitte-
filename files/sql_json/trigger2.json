{
  "trigger_metadata": {
    "trigger_name": "trigger2",
    "timing": "AFTER",
    "events": [
      "INSERT",
      "UPDATE",
      "DELETE"
    ],
    "table_name": "unknown_table",
    "has_declare_section": true,
    "has_begin_section": true,
    "has_exception_section": true
  },
  "declarations": {
    "variables": [
      {
        "name": "v_count_t_mappings",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "v_count_t_mol_map",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "v_molecule_seq_no",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "v_seq_no_duplicate_cnt",
        "data_type": "PLS_INTEGER",
        "default_value": null
      },
      {
        "name": "v_manual_short_desc",
        "data_type": "THEMES.MANUAL_SHORT_DESC%TYPE",
        "default_value": null
      }
    ],
    "constants": [],
    "exceptions": [
      {
        "name": "err_map_exists",
        "type": "user_defined"
      },
      {
        "name": "err_molec_id_missing",
        "type": "user_defined"
      },
      {
        "name": "err_no_portf_molecule_left",
        "type": "user_defined"
      },
      {
        "name": "err_upd_inv_map",
        "type": "user_defined"
      },
      {
        "name": "err_ins_inv_map",
        "type": "user_defined"
      },
      {
        "name": "err_inv_mol_sequence",
        "type": "user_defined"
      },
      {
        "name": "update_upd",
        "type": "user_defined"
      }
    ]
  },
  "data_operations": [
    {
      "id": "code_1",
      "sql": "SELECT manual_short_desc INTO v_manual_short_desc from gmd.themes where theme_no = NVL(:new.theme_no, :old.theme_no)",
      "type": "select_statements"
    },
    {
      "id": "code_2",
      "sql": "SELECT COUNT (*) INTO v_count_t_mappings FROM v_theme_molecule_map tmm WHERE tmm.theme_no = :new.theme_no AND tmm.valid_ind = 'Y'",
      "type": "select_statements"
    },
    {
      "id": "code_3",
      "sql": "SELECT COUNT (*) INTO v_count_t_mol_map FROM v_theme_molecule_map tmm WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id AND tmm.valid_ind = 'Y'",
      "type": "select_statements"
    },
    {
      "id": "code_4",
      "sql": "SELECT COUNT (*) INTO v_count_t_mol_map FROM v_theme_molecule_map tmm WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id AND tmm.valid_ind = 'N'",
      "type": "select_statements"
    },
    {
      "id": "code_5",
      "sql": "SELECT COUNT (*) INTO v_seq_no_duplicate_cnt FROM (SELECT molecule_seq_no FROM theme_molecule_map tmm WHERE tmm.theme_no = :new.theme_no AND valid_ind = 'Y' GROUP BY molecule_seq_no HAVING COUNT (*) > 1)",
      "type": "select_statements"
    },
    {
      "id": "code_6",
      "sql": "INSERT INTO theme_molecule_map tmm (tmm.theme_no ,tmm.molecule_id ,tmm.molecule_seq_no ,tmm.molecule_map_char ,tmm.valid_ind) VALUES ( :new.theme_no ,:new.molecule_id ,:new.molecule_seq_no ,:new.molecule_map_char ,'Y')",
      "type": "insert_statements"
    },
    {
      "id": "code_7",
      "sql": "INSERT INTO theme_molecule_map tmm (tmm.theme_no ,tmm.molecule_id ,tmm.molecule_seq_no ,tmm.molecule_map_char ,tmm.valid_ind) VALUES (:new.theme_no ,:new.molecule_id ,:new.molecule_seq_no ,:new.molecule_map_char ,'Y')",
      "type": "insert_statements"
    },
    {
      "id": "code_8",
      "sql": "INSERT INTO theme_molecule_map tmm (tmm.theme_no ,tmm.molecule_id ,tmm.molecule_seq_no ,tmm.molecule_map_char ,tmm.valid_ind) VALUES (:new.theme_no ,:new.molecule_id ,:new.molecule_seq_no ,:new.molecule_map_char ,'Y')",
      "type": "insert_statements"
    },
    {
      "id": "code_9",
      "sql": "INSERT INTO theme_molecule_map tmm (tmm.theme_no ,tmm.molecule_id ,tmm.molecule_seq_no ,tmm.molecule_map_char ,tmm.valid_ind) VALUES (:new.theme_no ,:new.molecule_id ,:new.molecule_seq_no ,:new.molecule_map_char ,'Y')",
      "type": "insert_statements"
    },
    {
      "id": "code_10",
      "sql": "INSERT INTO theme_molecule_map tmm (tmm.theme_no ,tmm.molecule_id ,tmm.molecule_seq_no ,tmm.molecule_map_char) VALUES ( :new.theme_no ,:new.molecule_id ,:new.molecule_seq_no ,:new.molecule_map_char)",
      "type": "insert_statements"
    },
    {
      "id": "code_11",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'N' WHERE tmm.theme_no = :old.theme_no AND tmm.molecule_id = :old.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_12",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.molecule_seq_no = tmm.molecule_seq_no - 1 WHERE tmm.theme_no = :old.theme_no AND tmm.molecule_seq_no > :old.molecule_seq_no AND tmm.valid_ind = 'Y'",
      "type": "update_statements"
    },
    {
      "id": "code_13",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'Y' ,tmm.molecule_seq_no = :new.molecule_seq_no WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_14",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.molecule_seq_no = tmm.molecule_seq_no + 1 WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_seq_no >= :new.molecule_seq_no AND tmm.valid_ind = 'Y'",
      "type": "update_statements"
    },
    {
      "id": "code_15",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'Y' ,tmm.molecule_seq_no = :new.molecule_seq_no WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_16",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.molecule_map_char = :new.molecule_map_char WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_17",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'N' WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :old.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_18",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.molecule_seq_no = tmm.molecule_seq_no - 1 WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_seq_no > :old.molecule_seq_no AND tmm.valid_ind = 'Y' AND tmm.molecule_seq_no <= :new.molecule_seq_no",
      "type": "update_statements"
    },
    {
      "id": "code_19",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.molecule_seq_no = tmm.molecule_seq_no + 1 WHERE tmm.theme_no = :new.theme_no AND tmm.valid_ind = 'Y' AND tmm.molecule_seq_no >= :new.molecule_seq_no AND tmm.molecule_seq_no < :old.molecule_seq_no",
      "type": "update_statements"
    },
    {
      "id": "code_20",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'Y' ,tmm.molecule_seq_no = :new.molecule_seq_no ,tmm.molecule_map_char =: new.molecule_map_char WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_21",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'N' WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :old.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_22",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.molecule_seq_no = tmm.molecule_seq_no - 1 WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_seq_no > :old.molecule_seq_no AND tmm.molecule_seq_no <= :new.molecule_seq_no AND tmm.valid_ind = 'Y'",
      "type": "update_statements"
    },
    {
      "id": "code_23",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'Y' ,tmm.molecule_seq_no = :new.molecule_seq_no ,tmm.molecule_map_char =:new.molecule_map_char WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_24",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'N' WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :old.molecule_id AND molecule_seq_no = :old.molecule_seq_no",
      "type": "update_statements"
    },
    {
      "id": "code_25",
      "sql": "UPDATE theme_molecule_map tmm SET tmm.valid_ind = 'Y' ,tmm.molecule_seq_no = :new.molecule_seq_no ,tmm.molecule_map_char =:new.molecule_map_char WHERE tmm.theme_no = :new.theme_no AND tmm.molecule_id = :new.molecule_id",
      "type": "update_statements"
    },
    {
      "id": "code_26",
      "sql": "IF (DELETING) THEN",
      "type": "if_else"
    },
    {
      "id": "code_27",
      "sql": "IF (INSERTING OR UPDATING) THEN",
      "type": "if_else"
    },
    {
      "id": "code_28",
      "sql": "IF (:new.molecule_id IS NULL) THEN RAISE err_molec_id_missing",
      "type": "if_else"
    },
    {
      "id": "code_29",
      "sql": "IF (UPDATING) THEN IF (:new.molecule_seq_no > v_count_t_mappings) THEN RAISE err_upd_inv_map",
      "type": "if_else"
    },
    {
      "id": "code_30",
      "sql": "IF (v_count_t_mol_map > 0) THEN RAISE err_map_exists",
      "type": "if_else"
    },
    {
      "id": "code_31",
      "sql": "IF (v_count_t_mol_map > 0) THEN invalid_mapping_exists := TRUE",
      "type": "if_else"
    },
    {
      "id": "code_32",
      "sql": "IF (INSERTING) THEN CASE WHEN :new.molecule_seq_no = v_count_t_mappings + 1 THEN IF (invalid_mapping_exists) THEN",
      "type": "if_else"
    },
    {
      "id": "code_33",
      "sql": "IF (invalid_mapping_exists) THEN",
      "type": "if_else"
    },
    {
      "id": "code_34",
      "sql": "IF (UPDATING) THEN IF (:new.molecule_id IS NOT NULL) THEN IF (:new.molecule_id = :old.molecule_id AND :new.molecule_seq_no = :old.molecule_seq_no) AND :new.molecule_map_char <> :old.molecule_map_char then",
      "type": "if_else"
    },
    {
      "id": "code_35",
      "sql": "IF (:new.molecule_id = :old.molecule_id AND :new.molecule_seq_no <> :old.molecule_seq_no) THEN",
      "type": "if_else"
    },
    {
      "id": "code_36",
      "sql": "IF (:old.molecule_seq_no < :new.molecule_seq_no) THEN",
      "type": "if_else"
    },
    {
      "id": "code_37",
      "sql": "IF (invalid_mapping_exists) THEN",
      "type": "if_else"
    },
    {
      "id": "code_38",
      "sql": "IF (:new.molecule_id <> :old.molecule_id AND :new.molecule_seq_no <> :old.molecule_seq_no) THEN",
      "type": "if_else"
    },
    {
      "id": "code_39",
      "sql": "IF (invalid_mapping_exists) THEN",
      "type": "if_else"
    },
    {
      "id": "code_40",
      "sql": "IF (invalid_mapping_exists) THEN",
      "type": "if_else"
    },
    {
      "id": "code_41",
      "sql": "IF (v_seq_no_duplicate_cnt > 0) THEN RAISE err_inv_mol_sequence",
      "type": "if_else"
    },
    {
      "id": "code_42",
      "sql": "IF (:new.molecule_id <> NVL (:old.molecule_id, '-1')) THEN",
      "type": "if_else"
    },
    {
      "id": "code_43",
      "sql": "IF (:new.molecule_id <> :old.molecule_id) AND :new.molecule_seq_no = :old.molecule_seq_no THEN",
      "type": "if_else"
    },
    {
      "id": "code_44",
      "sql": "RAISE err_ins_inv_map",
      "type": "exception_statements"
    }
  ],
  "exception_handlers": [
    {
      "exception_name": "err_map_exists",
      "handler_code": "raise_application_error (-20110, 'MDM_THEME_MOLECULE_MAP_IOF')"
    },
    {
      "exception_name": "err_molec_id_missing",
      "handler_code": "raise_application_error (-20111, 'MDM_THEME_MOLECULE_MAP_IOF')"
    },
    {
      "exception_name": "err_upd_inv_map",
      "handler_code": "raise_application_error (-20112, 'MDM_THEME_MOLECULE_MAP_IOF')"
    },
    {
      "exception_name": "err_ins_inv_map",
      "handler_code": "raise_application_error (-20113, 'MDM_THEME_MOLECULE_MAP_IOF')"
    },
    {
      "exception_name": "err_inv_mol_sequence",
      "handler_code": "raise_application_error (-20120, 'MDM_THEME_MOLECULE_MAP_IOF')"
    }
  ]
}